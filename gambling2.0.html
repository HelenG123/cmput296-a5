<!DOCTYPE html>
<html>
  <head>
    <title>Blackjack</title>
    <meta charset="UTF-8"/>
    <link href="https://fonts.googleapis.com/css?family=Shadows+Into+Light" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Shadows+Into+Light+Two" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/babel-standalone/babel.js"></script>
    <style> 

      /* Make the background black and change the font and its size. */
      body {
        background-color: black; 
        font-family: 'Shadows Into Light', cursive;
        color: white;
      }

    /* STYLE THE TOP PART OF THE WEBSITE */
      /* Use the blackjack gif on the page and cut off the weird text at the top. */
      /* Position the status and session in the center */
      .afterHeader {
        /* text-align: center; */
        background-image: url("https://i.pinimg.com/originals/1d/90/f3/1d90f3c0dab3cf0d5d18634722c87fbd.jpg");
        background-repeat: no-repeat;
        background-position: left -20px;
        background-size: 35%;
        height: 309px;
        text-align: center;  
      }

      .status, .session {
        margin-left: 400px;
      }

      /* Make the status font size bigger and position it to the right of the webpage. */
      .status {
        
        font-size: 80px; 
      }

      /* Make the session font size smaller and position it to the right side of the webpage. */
      .session {
        font-size: 50px; 
        /* margin-left: 420px; */
      }

      /***************************************************************************************/
    
    /* MORE STYLING */
      /* Style the blackjack rule section and the license */
      .beforeFooter {
        text-align: center; 
      }

      .rulesTitle {
        font-size: 60px;
        padding-bottom: 0px;
        margin-bottom: -30px;
      }

      .rulesContent {
        font-size: 30px;
        padding-top: 0px;
        margin-top: 0px;
        font-family: 'Shadows Into Light Two', cursive;
      }

      footer {
        margin-top: 30px;
        margin-bottom: 20px;
        font-family: 'Shadows Into Light Two', cursive;
        font-size: 20px;
      }

      a {
        color: #F6CB00;
      }

      .moneyBetDealerCards {
        font-size: 60px;
        text-align: center;
      }

    /* STYLING THE BETTING COMPONENT */
      .betting p {
        display: inline-block;
        padding-left: 15px;
        padding-right: 15px;
        margin-top: -30px;
        text-align: center;
        margin-left: 50px; 
        font-size: 45px;
      }

      .moneyAmount, .betAmount, .betButton {
        font-size: 60px;
        font-weight: bold;
      }

      .moneyDisplay {
        background-image: url("https://cdn.streamlabs.com/users/5497073/library/Emotion_Joy_Gumdrop-Money-Rain.gif");
        background-repeat: no-repeat;
        background-position: center -10px;
        background-size: 100%;
        height: 150px;
      }
      
      .betAmountDisplay {
        background-image: url("http://cdn.streamlabs.com/users/4701422/library/tumblr_mbnik2lM8i1qdpzt2o1_1280%5B1%5D.gif");
        background-repeat: no-repeat;
        background-size: 120%;
        background-position: center 50px;
        background-position-x: -40px;
        height: 150px;
      }

      .betButton {
        padding: 20px 30px;
        border-radius: 8px;
      }

      .dealersCards {
        display: inline-block;
        background-image: url("https://media.giphy.com/media/Y4fKJtYARiNag/source.gif");
        background-repeat: no-repeat;
        background-position: center;
        background-size: 60%;
        height: 200px;
        float: center;
        color: white;
      }

      .yourCards {
        font-weight: bold;
        font-style: italic;
        font-size: 80px;
      }
      /* Add a pseudoelement to put the money amount */

      .results {
        margin-top: -30px;
        margin-bottom: -20px;
        margin-left: 10px;
        font-size: 40px;
        font-weight: bold;
      }

      .playersActions {
        margin-left: 150px;
        margin-top: -50px;
        margin-bottom: 50px;
        font-size: 40px;
      }
   
      /* Taken from W3 Schools */
      /* Link:  */
      button {
        -webkit-transition-duration: 0.4s; 
        transition-duration: 0.4s;
        /* display: inline-block; */
        font-family: 'Shadows Into Light Two', cursive;
        font-size: 60px;
        background-color: #F6CB00;
        padding: 30px 30px;
        text-align: center;
        color: black;
        margin-right: 10px;
        /* margin-left: 20px; */
      }

      button:hover {
        background-color: black; 
        color: white;
      }

      input {
        font-family: 'Shadows Into Light Two', cursive;
        font-weight: bold;
        display: inline-block;
        text-align: center;
        width: 10%;
        font-size: 50px;
      }
/* 
     


    /****************************************************************************************/
    </style>
  </head>
  <body>

    <!-- USING REACT  -->
    <!-- This is the canonical way to use react: the one root div -->
    <div id="root"></div>
    <script type="text/babel">{
      'use strict';

      // The parent component 
      class Gambler extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            url: "https://pizza.cs.ualberta.ca/296/", 
            token: "tpYCGn9+pPJuG4jN4n5VPm4K86THIpS/KzIYpViOfXY=", 
            money: 0, 
            session: "", 
            status: null, 
            game: null, 
            last_game: null, 
            bet: 0,
            amount: 0,
            betButtonClicked: false, 
          };
          this.changed = this.changed.bind(this);
          this.handleClick = this.handleClick.bind(this);
          this.callFetch = this.callFetch.bind(this);

          // Fetch the initial game state and set it to gameState
          // LOCAL STORAGE this.callFetch(this.state.url);
          this.callFetch(this.state.url+"sit");
        
        }

        // The general fetch method
        callFetch(url) {
          var formData = new FormData();
          // Store the token in the formData to be sent with the POST request.
          formData.append("token", this.state.token);
          formData.append("amount", this.state.amount);
          var that = this;
          

          // Fetch the POST request
          fetch(url, {
            method: 'POST', 
            body: formData, 
          }) 

          // Retrieve the JSON body with the game state
          .then(function(response) {
            that.state.status = response.statusText;
            return response.json()
          })

          // Set the state to the current game state
          .then(function(response) {
            that.setState(response); 
            
          });
        }
        // Update the State of the gambling game.
        changed(event) {
          var name = event.target.name;
          var value = event.target.value;
          this.setState({
            [name]: value,
          });
        }

        handleClick(event) {
          var name = event.target.name;
          var value = event.target.value;
          this.setState({
            [name]: value,
          });
          
          if (name == "bet") {
            this.callFetch(this.state.url+this.state.session+"/bet");

            // To help make the other buttons unclickable, set the Boolean value
            // to true. 
            this.state.betButtonClicked = true; 
          }
        }

        render() {
          
          return ( 
           
            <div>
              <Status status = {this.state.status} session = {this.state.session} />
              <Betting money = {this.state.money} amount = {this.state.amount} bet = {this.state.bet} changed = {this.changed} handleClick = {this.handleClick}/>
              <Game state = {this.state}/> 
            </div>
            
          );
        }

      }

      class Status extends React.Component {
        // Component that contains the status and session. 
        render() {
          return (
             // Display the status and session of the webpage
            <div>
            
              <section className = "afterHeader">
                  <p> <span className = "status"> Status: {this.props.status} </span> <br/>
                      <span className = "session"> Session: {this.props.session} </span> 
                  </p>
              </section>
            </div>
          );
        }
      }
      
      class Betting extends React.Component {
        // Component which contains the money display and betting amount and the bet button

        render() {
          // for testing: console.log(this);
          return (
            <div>
              <section className = "betting"> 

                {/* The money title with the player's money amount remaining */}
                <p className = "moneyDisplay"> 
                  Money:
                  <span className = "moneyAmount"> {this.props.money} </span>
                </p>
                
                {/* The bet button */}
                <p> 
                  <button className = "betButton" type = "button" name = "bet" value = {this.props.amount}  onClick={this.props.handleClick}> Bet </button>
                  <input type = "number" name = "amount" value = {this.props.amount} onChange ={this.props.changed}/>
                </p> 

                {/* The 'You Bet' title with the bet amount*/}
                <p className = "betAmountDisplay">You Bet: 
                  <span className = "betAmount"> {this.props.bet} </span>
                </p>

              </section>

              
            </div>
       
          );
        }
      }

      class Game extends React.Component {
      // Component that contains 
      render() {
        
        // if (this.props.dealerHand == "null") {
        //   this.props.dealerHand = "";
        // }
        return (
          <div>
            <section className = "moneyBetDealerCards">
               {/*} <span className = "dealersCards"> {this.props.dealerHand} </span> */}
                
            </section>
          </div>
        )
      }

      }
      ReactDOM.render(<main>
        <Gambler/>
      </main>, document.getElementById('root'));
      } 
    </script>
    
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
   
  <!-- STATIC HTML   -->

    <!-- Displays the money, the bet, and the dealer's cards -->
    <section class = "moneyBetDealerCards">
      <p> 
        <!-- Money display -->
        <!-- <span class = "money"> Money </span> &emsp;&emsp;&emsp;  -->

        <!-- Bet Display -->
        <!-- <span class = "bet"> 
          <button type="button" name = "betButton" > Bet </button> 
          <input type="number" value="0"/>
        </span> &emsp;&emsp;  -->

        <!-- Dealer's Cards Display -->
        <!-- <span class = "dealersCards"> Dealer's Cards </span> </br> -->

        <!-- Player's Cards Display -->
        <span class = "yourCards"> Your Cards </span> </br> 
      </p>
    </section>

    <!-- Display Player's Actions (e.g. Stand, Hit, etc) -->
    <section class = "playersActions">
        <button type="button" class = "stand" onclick="window.gambler.stand()">Stand</button>
        <button type="button" name = "hit" onclick="window.gambler.hit()">Hit</button>
        <button type="button" name = "double_down" onclick="window.gambler.double_down()">Double Down</button>
        <button type="button" name = "surrender" onclick="window.gambler.surrender()">Surrender</button>
    </section>

    <!-- Add a horizontal rule/line to divide the page -->
    <hr>

    <!-- Display results, amount of bet, and profit. -->
    <section class = "results">
      <p> Result: </br>
          Your Bet: </br>
          You Made: </br>
      </p>
    </section>


    <!-- Displays the rules and the license. -->
    <section class = "beforeFooter">
      <!-- These rules were taken from Joshua Campbell's gambling.html  -->
      <hr>
      <h1 class = "rulesTitle"> RULES </h1>
      <span class = "rulesContent"> 
        <p> The version of blackjack that we're using here involves: </br>
            * no splitting; </br>
            * the dealer hitting on Soft 17 and; </br>
            * allowing only late surrenders. </br>
          For more information on the rules of Blackjack: 
          <a href="https://en.wikipedia.org/wiki/Blackjack"> Click me! </a>
        </p>
      </span>
      <footer>
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">Assignment 5 </span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Helen Gezahegn </span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
      </footer>
    </section>


  </body>
  </html>
